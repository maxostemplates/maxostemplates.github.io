/* Place in styles.css */
body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }

--- FILE: main.js (Frontend interactions)
// Place in main.js
// Basic: fetch products and render, handle buy click

const API_BASE = 'https://your-backend.example.com/api'; // set to your deployed backend

async function fetchProducts() {
  try {
    const res = await fetch(`${API_BASE}/products`);
    const products = await res.json();
    populateLists(products);
  } catch (err) {
    console.error('Failed to fetch products', err);
  }
}

function populateLists(products) {
  const freeList = document.getElementById('freeList');
  const premiumList = document.getElementById('premiumList');

  products.forEach(p => {
    const card = document.createElement('div');
    card.className = 'p-4 bg-white rounded shadow';
    card.innerHTML = `
      <h4 class="font-semibold">${p.name}</h4>
      <p class="text-sm text-gray-600">${p.description || ''}</p>
      <div class="mt-3 flex items-center justify-between">
        <div class="text-lg font-bold">${p.price && p.price > 0 ? p.price + ' ZMW' : 'Free'}</div>
        <button data-id="${p.id}" class="buyBtn px-3 py-1 rounded border">${p.price && p.price > 0 ? 'Buy' : 'Download'}</button>
      </div>
    `;

    if (p.price && p.price > 0) premiumList.appendChild(card);
    else freeList.appendChild(card);
  });

  document.querySelectorAll('.buyBtn').forEach(btn => btn.addEventListener('click', onBuy));
}

async function onBuy(e) {
  const id = e.currentTarget.dataset.id;
  const isFree = !id; // guard (should not happen)

  const userId = null; // optional: integrate auth later

  // For free items, simply call a download or show link
  // For premium, call backend to create payment
  try {
    const res = await fetch(`${API_BASE}/payments/create`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ userId, templateId: id })
    });
    const data = await res.json();
    if (data.checkoutUrl) {
      // redirect to Lenco checkout
      window.location.href = data.checkoutUrl;
    } else {
      alert('Payment initiation failed');
    }
  } catch (err) {
    console.error('Payment error', err);
    alert('Payment error');
  }
}

// Init
fetchProducts();
